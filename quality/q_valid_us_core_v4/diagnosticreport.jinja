-- http://hl7.org/fhir/us/core/STU4/StructureDefinition-us-core-diagnosticreport-note.html
-- There is another lab-report-specific profile,
-- but this looks to be the "base DiagnosticReport" profile that covers the bare minimum.

SELECT
    id,
    (
        status IS NOT NULL
        AND category IS NOT NULL
        AND {{ utils.is_concept_valid('code') }}
        AND {{ utils.is_reference_of_type('subject', 'Patient') }}
        AND (
            effectiveDateTime IS NOT NULL
            OR {{ utils.is_period_valid('effectivePeriod') }}
        )
    ) AS valid
FROM {{ src }}
