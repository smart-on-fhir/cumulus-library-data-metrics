{% import 'utils.jinja' as utils %}

CREATE TABLE quality__q_ref_target_pop_{{ src|lower }}_{{ dest|lower }} AS (
WITH
{{ utils.extract_status(src, 'src_status') }}

SELECT
    src.id,
    src_status.status,
    src.{{ field }} AS target
FROM {{ src|lower }} AS src
LEFT JOIN src_status
ON src.id = src_status.id
WHERE
    src.{{ field }}.reference NOT LIKE '{{ dest }}/%'
);